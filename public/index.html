<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Visualización de información</title>
  </head>
  <body>
    <style>
      #container{
        width: 500px;
        height: 500px;
      }
    </style>
    <h1>Graficos</h1>
    <div id="container" ></div>

    <script type="module">
  //   import * as d3 from "https://cdn.jsdelivr.net/npm/d3@7/+esm";
  //   let data = await d3.json("school.json")
  //   let width = 2240;
  //   let height = 1080;
    
  //   console.log(data)

  //   //const nodesTest = data.nodes.map(d => ({...d})); Copia profunda
    
  //   const nodesTest = data.nodes; //Copia superficial

  //   const linkTest = data.edges
    
  //   console.log(nodesTest, linkTest)
  //   const nodes = [ 
  //       {"key": "1789", "attributes": {"color" : "#fff234", "label": "1789"}},
  //       {"key": "1780", "attributes": {"color" : "#ecc334", "label": "1780"}},
  //       {"key": "1785", "attributes": {"color" : "#edb034", "label": "1785"}}
  //     ];
  
  //     const links = [{"key": "3426", "source": "1789", "target": "1780", 
  //       "attributes": {
  //       "weight": 1.0,
  //       "2": 20,
  //       "3": 1}}
  //       , {"key": "3440", "source": "1780", "target": "1785",
  //       "attributes": {
  //       "weight": 1.0,
  //       "2": 40,
  //       "3": 50}}];

  //     const simulation = d3.forceSimulation(nodesTest)  
  //         .force("charge", d3.forceManyBody().strength(0))
  //         .force("link", d3.forceLink(linkTest).id(d => d.key).strength(0.1).distance(height/2).iterations(5))
  //         .force('center', d3.forceCenter())
  //        // .force("y", d3.forceY());

  //     const svg = d3.create("svg")
  //       .attr("width", width)
  //       .attr("height", height)
  //       .attr("viewBox", [-width / 2, -height / 2, width, height])
  //       .attr("style", "max-width: 100%; height: auto;");
      
  //     const link = svg.append("g")
  //         .attr("stroke", "#999")
  //         .attr("stroke-opacity", 0.6)
  //         .selectAll('.link')
  //         .data(linkTest)
  //           .enter().append("path")
  //           .attr("class", "link")
  //           .attr("d", d => {
  //             if (d.source === d.target) {
  //               // Crea una curva para el bucle
  //               return `M${d.source.x},${d.source.y}A${d.source.attributes.size},${d.source.attributes.size} 0 1,1 ${d.target.x},${d.target.y}`;
  //             } else {
  //               // Crea una línea recta para aristas normales
  //               return `M${d.source.x},${d.source.y}L${d.target.x},${d.target.y}`;
  //             }
  //           });
  //           //.attr("stroke-width", d => d.attributes.weight);

  //     const node = svg.append("g")
  //       .attr("stroke", "#7fba00")
  //       .attr("stroke-width", 1)
  //     .selectAll('circle')
  //     .data(nodesTest)
  //     .join("circle")
  //       .attr('r', 4)
  //       .attr('fill', d => d.attributes.color);
      
  //     node.append("title")
  //       .text(d => d.attributes.label);
  //  //   const lineGenerator = d3.line();
      
  //     node.call(d3.drag()
  //       .on("start", dragstarted)
  //       .on("drag", dragged)
  //       .on("end", dragended));

  //     simulation.on('tick', () => {
  //       link
  //         .attr("d", d => {
  //             if (d.source === d.target) {
  //               // Crea una curva para el bucle
  //               return `M${d.source.x},${d.source.y}A${d.source.attributes.size},${d.source.attributes.size} 0 1,1 ${d.target.x},${d.target.y}`;
  //             } else {
  //               // Crea una línea recta para aristas normales
  //               return `M${d.source.x},${d.source.y}L${d.target.x},${d.target.y}`;
  //             }
  //         });

  //         node.attr('cx', d => d.x)
  //             .attr('cy', d => d.y);
  //     });

  //     function dragstarted(event) {
  //       if (!event.active) simulation.alphaTarget(0.3).restart();
  //       event.subject.fx = event.subject.x;
  //       event.subject.fy = event.subject.y;}

  //     function dragged(event) {
  //       event.subject.fx = event.x;
  //       event.subject.fy = event.y;}

  //     function dragended(event) {
  //       if (!event.active) simulation.alphaTarget(0);
  //       event.subject.fx = null;
  //       event.subject.fy = null;
  // }

    //  document.addEventListener('DOMContentLoaded', () => {
       // const fetchBtn = document.getElementById('fetch-btn')
     //   const responseText = document.getElementById('response-output')

        // fetchBtn.addEventListener('click', async () => {
        // const response = await fetch('/.netlify/functions/hello')
        //   .then(response => response.json())
        // console.log(response)
        // responseText.innerText = response.message
        // }) })
      await fetch("http://localhost:8888/api/test")
      // .then(async d => {
    
      //   document.getElementById("container").innerHTML = await d.text() 
      //  // console.log(await d.arrayBuffer())
      // })
    </script>

  </body>
</html>
